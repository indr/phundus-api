@model SmtpSettingsViewModel

@{
    ViewBag.Title = "E-Mail-Einstellungen";
    Layout = "~/Views/Settings/Index.cshtml";
}

<h2>@ViewBag.Title</h2>
<p></p>

@using (Html.BeginForm(SettingsActionNames.MailGeneral, ControllerNames.Settings, FormMethod.Post, new { @class = "form-horizontal" }))
{
    <fieldset>
        <legend>SMTP</legend>
        
        <div class="control-group">
            @Html.HiddenFor(m => m.HostVersion)
            @Html.LabelFor(m => m.Host, new { @class = "control-label" })
            <div class="controls">
                @Html.EditorFor(m => m.Host)
                @Html.ValidationMessageFor(m => m.Host)
            </div>
        </div>

        <div class="control-group">
            @Html.HiddenFor(m => m.UserNameVersion)
            @Html.LabelFor(m => m.UserName, new { @class = "control-label" })
            <div class="controls">
                @Html.EditorFor(m => m.UserName)
                @Html.ValidationMessageFor(m => m.UserName)
            </div>
        </div>

        <div class="control-group">
            @Html.HiddenFor(m => m.PasswordVersion)
            @Html.LabelFor(m => m.Password, new { @class = "control-label" })
            <div class="controls">
                @Html.EditorFor(m => m.Password)
                @Html.ValidationMessageFor(m => m.Password)
            </div>
        </div>

        <div class="control-group">
            @Html.HiddenFor(m => m.FromVersion)
            @Html.LabelFor(m => m.From, new { @class = "control-label" })
            <div class="controls">
                @Html.EditorFor(m => m.From)
                @Html.ValidationMessageFor(m => m.From)
            </div>
        </div>

        <div class="control-group">
            <div class="controls">
                <a href="#" class="btn btn-normal" onclick="showSendTestEmailDialog('@Html.IdFor(m => m.Host)', '@Html.IdFor(m => m.UserName)', '@Html.IdFor(m => m.Password)', '@Html.IdFor(m => m.From)'); return false;">Einstellungen testen</a>
            </div>
        </div>
    </fieldset>
    <div class="form-actions">
            @Html.SubmitButton("Speichern")
            @Html.ActionLink(new Appearance { Caption = "Abbrechen", Button = Button.Normal }, "Index")
    </div>
    
    
    
    
}

<script type="text/javascript">
    function showSendTestEmailDialog(host, username, password, from) {
        var $div = $('#modal-send-test-email');

        //$div.find('.modal-header h3').html(title);

        var $body = $div.find('.modal-body');
        $body.find('#TestHost').val($('#' + host).val());
        $body.find('#TestUserName').val($('#' + username).val());
        $body.find('#TestPassword').val($('#' + password).val());
        $body.find('#TestFrom').val($('#' + from).val());

        $div.modal();
    }
    </script>

@Html.Partial("SendTestEmailViewModelDialog", new SendTestEmailViewModel())