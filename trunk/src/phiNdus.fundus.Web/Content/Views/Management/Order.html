<h2>Bestellung</h2>

<div x-ph-alert-loading />

<div ng-show="isLoaded" class="row">
    <div class="span6">
        <p>Nummer: {{order.orderId}}</p>
        <p>Status: {{order.status | orderStatusText}}</p>
        <p>Erstellt: {{order.createdOn | date:'medium'}}</p>
        <p>Bearbeitet: {{order.modifiedOn | date:'medium'}}</p>
    </div>
    <div class="span6">
        <p>Ausleiher: {{order.borrowerFirstName}} {{order.borrowerLastName}}</p>
        <p>J+S/Info Card: {{order.borrowerMemberNumber}}</p>
    </div>
</div>

<table ng-show="isLoaded" class="table table-bordered table-striped">
    <thead>
        <tr>
            <th>Artikel</th>
            <th>Verfügbar</th>
            <th>Von</th>
            <th>Bis</th>
            <th>Menge</th>
            <th>Stückpreis</th>
            <th>Total</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        <tr ng-repeat="item in order.items">
            <td>{{item.text}}</td>
            <td ng-show="item.isAvailable"><i class="icon-ok"></i></td>
            <td ng-show="!item.isAvailable"><i class="icon-remove"></i></td>
            <td ng-show="!item.editing">{{item.from | date:'mediumDate'}}</td>
            <td ng-show="!item.editing">{{item.to | date:'mediumDate'}}</td>
            <td ng-show="!item.editing">{{item.amount}}</td>
            <td ng-show="item.editing"><input class="input-small" type="text" ng-model="item.from" bs-datefield /></td>
            <td ng-show="item.editing"><input class="input-small" type="text" ng-model="item.to" bs-datefield /></td>
            <td ng-show="item.editing"><input class="input-mini" type="text" ng-model="item.amount" /></td>
            <td>{{item.unitPrice | currency}}</td>
            <td>{{item.itemTotal | currency}}</td>
            <td ng-show="!item.editing">
                <a ng-show="order.status == 'Pending'" class="btn" href="" ng-click="editItem(item)" title="Bearbeiten"><i class="icon-edit"></i></a>
                <a ng-show="order.status == 'Pending'" class="btn" href="" ng-click="removeItem(item)" title="Entfernen"><i class="icon-remove"></i></a>
            </td>
            <td ng-show="item.editing">
                <a class="btn" href="" ng-click="saveEditedItem(item)" title="Speichern"><i class="icon-ok"></i></a>
                <a class="btn" href="" ng-click="cancelEditing(item)" title="Verwerfen"><i class="icon-asterisk"></i></a>
            </td>
        </tr>

        <tr style="font-weight:bold">
            <td colspan="6" style="text-align:right;">Total</td>
            <td>{{getTotal() | currency}}</td>
            <td></td>
        </tr>
    </tbody>
</table>

<div class="row">
    <div class="span6">
        <a class="btn" href="" ph-history-back>Zurück</a>
        <a ng-show="isLoaded" class="btn" href="/api/organizations/{{organizationId}}/orders/{{order.orderId}}.pdf">PDF</a>
    </div>
    <div ng-show="isLoaded" class="span6" style="text-align:right">
        <a class="btn" ng-show="(order.status == 'Pending')" href="" ng-click="showAddItem(order)">Artikel hinzufügen</a>
        <a class="btn btn-primary" ng-show="order.status == 'Pending'" href="" ng-click="confirmOrder(order)">Bestätigen</a>
        <a class="btn btn-danger" ng-show="order.status == 'Pending'" href="" ng-click="rejectOrder(order)">Ablehnen</a>
        <a class="btn btn-primary" ng-show="order.status == 'Approved'" href="" ng-click="closeOrder(order)">Abschliessen</a>
    </div>
</div>

<div class="modal hide" id="modal-add-item">
    <div class="modal-header">
        <a class="close" data-dismiss="modal">×</a>
        <h3>Artikel hinzufügen</h3>
    </div>
    <div class="modal-body">
        <form class="form-horizontal">
            <div class="control-group">
                <label class="control-label" for="inputArticleId">Artikel-Id</label>
                <div class="controls">
                    <input type="text" id="inputArticleId" placeholder="" ng-model="newItem.articleId">
                </div>
            </div>
            <div class="control-group">
                <label class="control-label" for="inputFrom">Von</label>
                <div class="controls">
                    <input type="text" id="inputFrom" placeholder="" ng-model="newItem.from" bs-datefield>
                </div>
            </div>
            <div class="control-group">
                <label class="control-label" for="inputTo">Bis</label>
                <div class="controls">
                    <input type="text" id="inputTo" placeholder="" ng-model="newItem.to" bs-datefield>
                </div>
            </div>
            <div class="control-group">
                <label class="control-label" for="inputAmount">Menge</label>
                <div class="controls">
                    <input type="text" id="inputAmount" placeholder="" ng-model="newItem.amount">
                </div>
            </div>
        </form>
    </div>
    <div class="modal-footer">
        <a href="#" class="btn btn-primary" ng-click="addItem(newItem)" data-dismiss="modal">Hinzufügen</a>
        <a href="#" class="btn" data-dismiss="modal">Abbrechen</a>
    </div>
</div>